#!/usr/bin/env fish


set root (git rev-parse --show-toplevel 2> /dev/null)
set branch (git rev-parse --abbrev-ref HEAD 2> /dev/null)

if test -z "$root"
  echo "Run dev-commit in a git repository"
else if test -f "$root/.dev-commit"
  echo "dev-commit use local file "
  echo "$root/.dev-commit"
  # source "$root/.dev-commit"
else if test -d "$root"
  echo "dev-commit use default behaviour"
  set arg "$argv"
  if test -n $arg
    set message "[$branch] $arg"
  else
    set dirname (basename $root)
    set message "[$branch] update $dirname"
  end
  pushd $root &> /dev/null
  git add .
  git commit . -m $message
  git push
  popd
end
